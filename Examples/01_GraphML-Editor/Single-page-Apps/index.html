<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA GraphML Editor</title>
    <link rel="stylesheet" href="./styles/styles.css">
</head>
<body>
    <h1>A) Current Visual Graph</h1>
    <!-- <div class="rectangle" style="height: 50px;width: 100px;background-color: #555;color: #FFF;"> PLACE HOLDER FOR D3.js</div> -->
    <div id="d3-container">
      <svg id="graph-svg"></svg>
    </div>
    <button id="reset-d3-button">Reset Drawing</button>
    <button id="print-button">Print</button>
    <button id="save-config-button">Temp Save</button>
    <button id="load-config-button">Temp Load</button>
    <button id="export-config-button">Export Config</button>
    <input type="file" id="import-config-file" style="display:none" accept=".json">
    <button id="import-config-button">Import Config</button>

    <div id="context-menu" style="display: none; position: absolute; background-color: white; border: 1px solid black;">
      <label>
          Color:
          <input id="color-picker" type="color" value="#000000" />
      </label>
    </div>
  


    <hr>
    <h1>B) GraphML Object Editing</h1>
    <label for="graph-title">Graph Title:</label>
    <input type="text" id="graph-title" placeholder="Graph Title">
    <br>
    <label for="graph-directionality">Graph Directionality:</label>
    <select id="graph-directionality">
        <option value="undirected">Undirected</option>
        <option value="directed">Directed</option>
    </select>
    <!-- <button id="graph-directionality-button" type="button">Update Directionality</button> -->
    <br>
    <button id="update-graph-settings-button" type="button">Update Graph Options</button>


    <h2>I) Object Adding/Editing</h2>
    <button id="new-button">New Object</button><br>
    <hr style="width: 25%; float: left; margin-top: 0;">
    <br>

    <form id="graph-object-form">
        <label for="graph-type">Select New Object Type:</label>
        <select id="graph-type" onchange="toggleObjectTypeFields()">
            <option value="node">Node</option>
            <option value="edge">Edge</option>
        </select>
        <br>
    
        <label for="object-id">Object ID:</label>
        <input type="text" id="object-id" placeholder="Object ID">
        
        <div id="node-fields">
            <label for="node-label">Object Table Label:</label>
            <input type="text" id="node-label" placeholder="Label">
            <br>
            <div id="node-properties"></div>
            <button id="add-property-button" type="button">+</button>
          </div>
    
        <div id="edge-fields" style="display: none;">
            <label for="edge-label">Object Table Label:</label>
            <input type="text" id="edge-label" placeholder="Label">
            <br>
            <label for="edge-key">Edge Key:</label>
            <input type="text" id="edge-key" placeholder="color">
            <br>
            <label for="edge-value">Edge Value:</label>
            <input type="text" id="edge-value" placeholder="purple">
            <br>
            <label for="source-node">Source Node:</label>
            <select id="source-node"></select>
            <br>
            <label for="target-node">Target Node:</label>
            <select id="target-node"></select>
            <!-- add hidden inputs for source and target nodes -->
            <input type="hidden" id="source-node-id" value="">
            <input type="hidden" id="target-node-id" value="">

        </div>
        
        <br>
        <button id="submit-button" type="submit">Add Object</button>
    </form>

    <hr style="width: 90%; float: left; margin-top: 0;">
    <h2>II) Object Table</h2>
      <table id="graph-object-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Label</th>
            <th>Edit</th>
            <th>Remove</th>
        </tr>
        </thead>
        <tbody id="graph-object-table-body">
        </tbody>
      </table>

    <hr>
    <h2>III) Object Import/Export</h2>
      <input type="file" id="import-file" style="display:none" accept=".json">
      <button id="import-button">Import</button>
      <button id="export-button">Export</button>

  <hr>
  <h1>C) GraphML File Creation</h1>
  <div id="graphml-file"></div>
  <button id="save-graphml-button">Save .graphml File</button>

  <hr>
  <!-- make red, bold text in <h3> -->
  <h3 style="color:red;font-weight:bold;">DANGER</h3>
  <button id="reset-button">Reset LocalStorage</button>
  
  <!-- SCRIPTS -->
  <script src="./scripts/graphRendering.js"></script>
  <script src="./scripts/fileIO.js"></script>
  <script src="./scripts/SJFI/lib-localstorage.js"></script>
  <script src="./scripts/SJFI/lib-JSON-ImpExp.js"></script>
  <script src="./scripts/SJFI/lib-XML-ImpExp.js"></script>
  <script src="./scripts/graphUI.js"></script>

  <script src="./scripts/graphOperations.js"></script>
  <script src="./scripts/graphEditing.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <script>
    window.graphObjects = [];
    window.graphTitle = "";
    window.RenderNodes = [];
    window.graphDirectionality ="";
    window.GraphMLXMLData = "";
    window.editingIndex = null;
    window.SJFI_storageKey = 'SGE_graphObjects';

    window.addEventListener('DOMContentLoaded', () => {
        OperationsUIObjectsFormSetup();
        OperationsUIObjectsButtonSetup();

        loadGraphObjects(SJFI_storageKey);

        const storedTitle = localStorage.getItem(`${SJFI_storageKey}_title`);

        loadGraphSettings(SJFI_storageKey);
        updateGraphSettings();

        reprintGraphMLFile();
    });
  </script>
</body>
</html>
